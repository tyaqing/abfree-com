---
title: ExportX Figmaæ’ä»¶ä½¿ç”¨è¯´æ˜
description: ""
pubDate: 2024-05-12
---

# å¿«é€Ÿå¼€å§‹

æˆ‘ä»¬çš„æ’ä»¶æ”¯æŒ ã€Œè®¾è®¡æ¨¡å¼ã€å’Œã€ŒDevæ¨¡å¼ã€ï¼Œ æŸ¥çœ‹è§†é¢‘ï¼Œå¿«é€Ÿäº†è§£æ’ä»¶ä½¿ç”¨æ–¹å¼~

<video
    class="object-cover object-center"
    src="/images/preview.MOV"
    autoplay
    controls
    loop
/>

## å¯¼å‡ºæ ¼å¼æ”¯æŒä¸å‹ç¼©ç‡

æˆ‘ä»¬æ”¯æŒåŒæ—¶å‹ç¼©å¤šç§æ ¼å¼å’Œå€ç‡çš„å›¾ç‰‡ï¼Œä½†æ˜¯è§„åˆ™é™åˆ¶åœ¨**5æ¡**ä»¥å†…ï¼Œå›¾ç‰‡æ ¼å¼æ”¯æŒï¼š

| æ ¼å¼   | æ”¯æŒ     | èŠ‚çœç©ºé—´ |
|------|--------|------|
| AVIF | æ˜¯      | â‰ˆ92% |
| WEBP | æ˜¯      | â‰ˆ88% |
| JPG  | æ˜¯      | â‰ˆ85% |
| PNG  | æ˜¯      | â‰ˆ68% |
| SVG  | æ˜¯      | â‰ˆ8%  |
| ico  | ğŸš§ å¼€å‘ä¸­ | -    |

<Callout icon="ğŸ’¡" type="info">
å‹ç¼©æ•ˆæœæ ¹æ®ç»Ÿè®¡å¾—å‡ºï¼Œå®é™…æ•ˆæœå¯èƒ½æœ‰æ‰€ä¸åŒï¼Œæ­¤è¡¨æ ¼å°†æŒç»­æ›´æ–°ã€‚
</Callout>

## å†å²è®°å½•

æ’ä»¶å‹ç¼©çš„å›¾ç‰‡æˆ‘ä»¬ä¼šåœ¨æ‚¨çš„ç”µè„‘ä¸Šæ°¸ä¹…çš„å­˜å‚¨èµ·æ¥ï¼Œç›´åˆ°æ‚¨æ¸…ç©ºç¼“å­˜æˆ–è€…æ¸…é™¤å†å²çºªå½•ã€‚

å—é™äºå®¢æˆ·ç«¯å­˜å‚¨é™åˆ¶ï¼Œæˆ‘ä»¬ä»…ä¿å­˜**15æ¡**å†å²çºªå½•ã€‚

## å…è´¹å›¾åºŠæœåŠ¡

ExportXä¸ºæ‚¨æä¾›äº†èƒ½å¤Ÿå¿«é€Ÿä¸Šä¼ çš„å…è´¹å›¾åºŠï¼ŒæœåŠ¡å»ºç«‹åœ¨Cloudflareçš„å…è´¹CDNä¸Šï¼Œæˆ‘ä»¬ä¿è¯ä¸åˆ é™¤æ‚¨çš„å›¾ç‰‡ã€‚æ–¹ä¾¿æ‚¨0é…ç½®å³å¯è·å¾—ä¸Šä¼ ä½“éªŒã€‚

![](https://x.abfree.com/assets/bf160bbf-4326-4cb5-90ec-799a044fbbd9)

æ‰“å¼€æ’ä»¶å³ä¸Šè§’çš„å¼€å…³ï¼Œå³å¯ä½¿ç”¨æˆ‘ä»¬çš„å…è´¹å›¾åºŠæœåŠ¡ã€‚

![](https://x.abfree.com/assets/17c60acf-a5ec-40d8-979f-ab1d861c1ae8)

æ­¤æ—¶ï¼Œç‚¹å‡»"ExportX"æŒ‰é’®ï¼Œä¸€é”®å®Œæˆå‹ç¼©ã€ä¸Šä¼ æ“ä½œã€‚åœ¨å†å²è®°å½•ä¸­ï¼Œç‚¹å‡»å¤åˆ¶æŒ‰é’®ï¼Œå³å¯è·å¾—å›¾ç‰‡é“¾æ¥ã€‚

ä½¿ç”¨æˆ‘ä»¬çš„å…è´¹å›¾åºŠéœ€è¦éµå®ˆæˆ‘ä»¬çš„ç›¸å…³åè®®ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬æ›´æ¨èæ‚¨ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¼ æœåŠ¡ã€‚

# è‡ªå®šä¹‰ä¸Šä¼ æœåŠ¡

å¦‚æœæ‚¨æœ‰è‡ªå·±çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ›¿æ¢æˆè‡ªå·±çš„ä¸Šä¼ æ¥å£ã€‚
é¦–å…ˆï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„[è®¾ç½®],åœ¨ä¸Šä¼ è®¾ç½®ä¸­ï¼Œé€‰æ‹©"è‡ªå®šä¹‰"æ–¹å¼ã€‚

<div className="flex">
    <Image
        src="https://x.abfree.com/assets/3c196681-afa3-42b1-8716-320428204875"
        class="flex-1"
        width="446"
        height="507"
        alt="Image"
    />

    <Image
        src="https://x.abfree.com/assets/3691eb76-6dd5-4f59-a05b-81d3117b849b"
        class="flex-1"
        width="298"
        height="607"
        alt="Image"
    />
</div>


## ä¸Šä¼ æ¥å£è§„èŒƒ

å¼€å¯è‡ªå®šä¹‰ä¸Šä¼ åï¼Œå›¾ç‰‡ä¼šé€šè¿‡`POST`è¯·æ±‚ä¸Šä¼ åˆ°æ‚¨çš„æ¥å£ã€‚æ¥å£éœ€è¦éµå®ˆä»¥ä¸‹è§„èŒƒï¼š

#### Requestå†…å®¹
**Header:**
æ‚¨å¯ä»¥é€šè¿‡è‡ªå®šä¹‰headeræ¥ä¼ é€’tokenç­‰ä¿¡æ¯ã€‚
```
Content-Type: multipart/form-data;
```

**Bodyï¼š**
æ’ä»¶é€šè¿‡form-dataçš„æ–¹å¼ä¸Šä¼ æ–‡ä»¶ï¼Œä¸‹é¢çš„å‚æ•°æ˜¯æ’ä»¶æä¾›çš„ï¼ŒåŒæ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡è‡ªå®šä¹‰Bodyæ¥ä¼ é€’é¢å¤–çš„ä¿¡æ¯ã€‚

| å‚æ•°å       | ç±»å‹     | è¯´æ˜                                     |
|-----------|--------|----------------------------------------|
| file      | File   | äºŒè¿›åˆ¶æ–‡ä»¶                                  |
| fileName  | String | æ–‡ä»¶å,å¦‚image92.avif                      |
| format    | String | å›¾ç‰‡æ ¼å¼,å¦‚png                              |
| figmaName | String | Figmaç”¨æˆ·å                               |
| figmaId   | String | Figmaç”¨æˆ·ID ,19ä½çš„æ•°å­—ï¼Œå‚è€ƒ[Figma User](https://www.figma.com/plugin-docs/api/User/)  |

#### Responseå†…å®¹

æ‚¨éœ€è¦ç»™æ’ä»¶è¿”å›ä¸€ä¸ªjsonå¯¹è±¡ï¼ŒåŒ…å«å›¾ç‰‡çš„urlï¼Œurlç”¨äºå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¦‚æœæ²¡æœ‰è¿”å›urlï¼Œå¤åˆ¶æŒ‰é’®å°†ä¸å¯ç”¨ã€‚

```json
{
  "url": "https://dev.cdn.abfree.com/images/6FjJoXmt34ox0Fu1.png"
}
```

## Cloudflare R2+Worker

ç¤ºä¾‹ä»£ç ,æ­¤å¤„ä½¿ç”¨[hono](https://hono.dev/)æ¥æ¼”ç¤º

```ts
import {Hono} from 'hono'

type Bindings = {
  MY_BUCKET: R2Bucket
  CDN_URL: string
}

const app = new Hono<{
  Bindings: Bindings
}>()

app.post('/upload', async (c) => {
  const key = genFileKey()
  const formData = await c.req.parseBody()
  const file = formData['file']

  if (file instanceof File) {
    const fileBuffer = await file.arrayBuffer()
    const fullName = file.name
    const ext = fullName.split('.').pop()
    const path = `images/${key}.${ext}`

    let contentType = file.type
    
    if (contentType === 'image/svg') {
      contentType = 'image/svg+xml'
    }

    console.log(file.type)
    await c.env.MY_BUCKET.put(path, fileBuffer, {
      httpMetadata: {
        contentType: contentType,
        contentDisposition: `inline`
      },
    })
    return c.json({
      'url': `${c.env.CDN_URL}/${path}`
    })
  } else {
    return c.text('Invalid file', 400)
  }
})
```

## Amazon S3  æˆ–å…¼å®¹S3

å¤§å¤šæ•°å¯¹è±¡å­˜å‚¨éƒ½å…¼å®¹S3åè®®ï¼Œæ¯”å¦‚
- AWS S3
- Cloudflare R2
- Google Cloud Storage
- é˜¿é‡Œäº‘OSS
- è…¾è®¯äº‘COS

ç¤ºä¾‹ä»£ç 
```ts
// api.ts
import {Hono} from 'hono'
import {uploadToS3} from "./s3";

type Bindings = {
  CDN_URL: string
}

const app = new Hono<{
  Bindings: Bindings
}>()

app.post('/uploadS3',async (c)=>{
  const key = genFileKey()
  const formData = await c.req.parseBody()
  const file = formData['file']
    if (file instanceof File) {
      const fileBuffer = await file.arrayBuffer()
      const fullName = file.name
      const ext = fullName.split('.').pop()
      const path = `images/${key}.${ext}`
      let contentType = file.type
      if (contentType === 'image/svg') {
        contentType = 'image/svg+xml'
      }
      const uint8Array = new Uint8Array(fileBuffer)
      await uploadToS3(c, {
        file:uint8Array,
        contentType,
        key:key
      })
      return c.json({
        'url': `${c.env.CDN_URL}/${path}`
      })
    } else {
      return c.text('Invalid file', 400)
    }
})

```

```ts
// s3.ts
import {S3} from "@aws-sdk/client-s3";
import {Context} from "hono";

let s3Client: S3
interface UploadParams {
  file: Uint8Array
  contentType: string
  key: string
}
export async function uploadToS3(c: Context, params:UploadParams) {
  const client = getClient(c)
  await client.putObject({
    Body: params.file,
    Bucket: c.env.S3_BUCKET,
    Key: params.key,
    ContentType: params.contentType,
  })
}
function getClient(c: Context) {
  if (s3Client) return s3Client
  const {S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY, S3_ENDPOINT, S3_REGION} = c.env
  s3Client = new S3({
    credentials: {
      accessKeyId: S3_ACCESS_KEY_ID,
      secretAccessKey: S3_SECRET_ACCESS_KEY,
    },
    endpoint: S3_ENDPOINT,
    region: S3_REGION,
  })
  return s3Client
}

```

# QA

## ä¸Šä¼ æ˜¯å¦‚ä½•å‘èµ·çš„

ä¸ºäº†ä¿æŠ¤æ‚¨å›¾ç‰‡çš„éšç§æ€§ï¼Œä¸Šä¼ è¡Œä¸ºæ˜¯ç”±å‰ç«¯å‘èµ·ï¼Œå› æ­¤æ‚¨å¯èƒ½éœ€è¦å¤„ç†è·¨åŸŸé—®é¢˜ã€‚

## å¦‚ä½•ä¿è¯æœåŠ¡ä¸è¢«æ»¥ç”¨

`figmaId`æ˜¯ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œå®ƒåŒ…å«åœ¨ä¸Šä¼ çš„bodyå½“ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç™½åå•+passwordæ–¹å¼æ¥é™åˆ¶ç”¨æˆ·ä¸Šä¼ çš„é¢‘ç‡ã€‚




